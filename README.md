# StockOpt

The purpose of this package is to solve the portfolio optimization problem, which is essentially a mixed integer programming problem. Based on [pulp](https://pypi.org/project/PuLP/), we have achieved a rapid dynamic adjustment based on yesterday's position, which maximize the weighted alpha scores minus the transaction costs.

## Usage

```
stocks = pd.read_csv("input_format.csv")
sect_constrains = pd.read_csv("section_cons.csv").to_dict()

rules = {"stock_num":200,                      # pick exact 200 stocks
         "tcost":0.005 * 1,                    # tcost, set to 0 when setting up position
         "section":[sect_constrains, 0.01],    # expect value, tolerance
         "mv":[0.35, 0.02],                    # expect value, tolerance
         "trend":[0.05, 0.01]}                 # expect value, tolerance
         
solver = Solver(pool, rules=rules)
solver.solve()

solver.evaluate()
```

Which will give the trading instructions:

```
[Before Adjust] Score: 0.000562    Percentile: 0.2454
[~After Adjust] Score: 0.001038    Percentile: 0.0654

>> Turnover:    
 Buy in 0.208563   Adjust 0.1536

>> Market Value:
 Before 0.318145   After 0.3469   Target 0.3500   Δ -0.0031 

>> Trend:       
 Before 0.052588   After 0.0491   Target 0.0500   Δ -0.0009

Section exposure:

              before     after   target         Δ
sect                                            
801150.SI  0.120030  0.136791  0.12211  0.014681
801080.SI  0.112350  0.114496  0.11728 -0.002784
801750.SI  0.091726  0.083129  0.08575 -0.002621
801030.SI  0.064217  0.064536  0.07318 -0.008644
801760.SI  0.047133  0.047813  0.05414 -0.006327
801050.SI  0.038847  0.028582  0.03530 -0.006718
801790.SI  0.038634  0.031825  0.03734 -0.005515
801730.SI  0.038613  0.043653  0.04547 -0.001817
801180.SI  0.035906  0.039187  0.03521  0.003977
801890.SI  0.035594  0.032016  0.03399 -0.001974
801740.SI  0.034448  0.037705  0.03114  0.006565
801170.SI  0.033628  0.037595  0.03111  0.006485
801040.SI  0.033282  0.031212  0.02925  0.001962
801880.SI  0.032307  0.033650  0.03004  0.003610
801010.SI  0.030959  0.024227  0.02874 -0.004513
801160.SI  0.029650  0.034019  0.03180  0.002219
801770.SI  0.025387  0.022107  0.02498 -0.002873
801200.SI  0.022971  0.017937  0.02710 -0.009163
801120.SI  0.021875  0.032131  0.02691  0.005221
801710.SI  0.020979  0.018737  0.01805  0.000687
801140.SI  0.015623  0.013275  0.01778 -0.004505
801720.SI  0.013287  0.007407  0.01180 -0.004393
801780.SI  0.013109  0.021063  0.01153  0.009533
801230.SI  0.012069  0.017558  0.01299  0.004568
801020.SI  0.010610  0.008359  0.01137 -0.003011
801110.SI  0.008991  0.014100  0.00776  0.006340
801210.SI  0.005994  0.004137  0.00514 -0.001003
801130.SI  0.002997  0.002753  0.00277 -0.000017


New buy in:

  002049   0% -> 0.65%      |     300408   0% -> 0.64%      |     600584   0% -> 0.37%  
  603658   0% -> 0.82%      |     300685   0% -> 0.94%      |     603515   0% -> 0.41%  
  000021   0% -> 0.36%      |     300438   0% -> 0.62%      |     600855   0% -> 1.34%  
  002850   0% -> 0.64%      |     300454   0% -> 0.48%      |     300072   0% -> 0.71% *
  002603   0% -> 1.20% *    |     002171   0% -> 1.27%      |     603444   0% -> 0.72%  
  600271   0% -> 0.69%      |     002138   0% -> 0.40%      |     300124   0% -> 1.38%  
  002782   0% -> 0.65%      |     002273   0% -> 0.42%      |     002025   0% -> 0.99%  
  300010   0% -> 0.97%      |     300142   0% -> 1.20% *    |     300146   0% -> 0.84%  
  601336   0% -> 0.67%      |     600570   0% -> 0.70%      |     603259   0% -> 0.79%  


Sell:

  300674   0.65% -> 0%      |     601225   0.30% -> 0%      |     603916   0.44% -> 0%
  000786   0.30% -> 0%      |     600984   0.76% -> 0%      |     002460   1.00% -> 0%
  601888   0.30% -> 0%      |     603429   0.36% -> 0%      |     300070   0.30% -> 0%
  000938   0.50% -> 0%      |     002091   0.37% -> 0%      |     601003   0.26% -> 0%
  600060   0.30% -> 0%      |     002607   0.72% -> 0%      |     600114   0.40% -> 0%
  300595   0.69% -> 0%      |     600887   0.50% -> 0%      |     002233   0.30% -> 0%
  600507   0.32% -> 0%      |     002624   0.50% -> 0%      |     002382   0.40% -> 0%
  603605   0.71% -> 0%      |     300503   0.33% -> 0%      |     600410   0.69% -> 0%
  600801   0.30% -> 0%      |     000998   0.50% -> 0%      |     002153   0.68% -> 0%
  002281   0.73% -> 0%      |     603881   0.81% -> 0%      |     603516   0.38% -> 0%


Adjust:

  600064   0.40% -> 0.50%    |   000001   0.30% -> 0.44%    |   002050   0.30% -> 0.85%
  300034   0.38% -> 0.43%    |   600585   0.30% -> 0.32%    |   000009   0.41% -> 0.48%
  000011   0.20% -> 0.52%    |   601611   0.22% -> 0.17%    |   603660   0.35% -> 0.28%
  300559   0.38% -> 0.47%    |   000019   0.38% -> 0.53%    |   300052   0.40% -> 0.54%
  603160   0.99% -> 0.42%    |   300570   0.31% -> 0.27%    |   002075   0.40% -> 0.73%
  603678   0.58% -> 0.49%    |   000036   0.24% -> 0.19%    |   601126   0.31% -> 0.18%
  002600   0.71% -> 0.27%    |   600109   1.02% -> 0.73%    |   002097   0.34% -> 0.51%
  601137   0.66% -> 0.30%    |   002106   0.46% -> 0.70%    |   002107   0.34% -> 0.69%
  603707   0.60% -> 0.50%    |   600125   0.37% -> 0.34%    |   603708   0.40% -> 0.11%
  300607   0.39% -> 0.92%    |   600639   0.33% -> 0.28%    |   002120   0.39% -> 0.42%
  300618   0.70% -> 0.40%    |   300623   0.65% -> 0.11%    |   002128   0.46% -> 0.54%
  002131   0.59% -> 0.75%    |   300627   0.41% -> 0.57%    |   000596   0.85% -> 1.18%
  300630   0.58% -> 0.18%    |   002135   0.40% -> 0.35%    |   000598   0.29% -> 0.20%
  601689   0.75% -> 0.48%    |   603738   0.39% -> 0.39%    |   000089   0.38% -> 0.60%
  603228   0.93% -> 0.11%    |   000090   0.34% -> 0.53%    |   002142   0.30% -> 0.45%
  002145   0.40% -> 0.58%    |   600161   0.99% -> 0.44%    |   600167   0.30% -> 0.66%
  603239   0.39% -> 0.33%    |   600171   0.70% -> 0.61%    |   300144   0.30% -> 0.41%
  002161   0.39% -> 0.52%    |   601200   0.41% -> 0.23%    |   002679   0.17% -> 0.16%
  600188   0.30% -> 0.30%    |   002174   0.44% -> 0.59%    |   600191   0.39% -> 0.63%
  002697   0.40% -> 0.41%    |   002698   0.34% -> 0.35%    |   600201   0.95% -> 0.39%
  600720   0.30% -> 0.87%    |   000656   0.40% -> 0.49%    |   002709   0.71% -> 0.67%
  600729   0.34% -> 0.63%    |   300702   0.39% -> 0.50%    |   001696   0.40% -> 0.40%
  000672   0.30% -> 0.49%    |   002215   0.34% -> 0.58%    |   300200   0.34% -> 0.96%
  002217   0.40% -> 0.21%    |   000686   0.66% -> 0.11%    |   002223   1.01% -> 0.64%
  600765   0.43% -> 0.43%    |   603839   0.30% -> 0.28%    |   002241   0.50% -> 0.11%
  002242   0.30% -> 0.56%    |   002244   0.27% -> 0.27%    |   300741   0.34% -> 0.60%
  000708   0.49% -> 0.50%    |   300231   0.40% -> 0.56%    |   300232   0.39% -> 0.11%
  601799   0.91% -> 1.37%    |   002250   0.41% -> 0.66%    |   603336   0.40% -> 0.68%
  603338   0.83% -> 0.90%    |   000717   0.41% -> 0.23%    |   600782   0.45% -> 0.19%
  000729   0.50% -> 0.60%    |   002271   0.30% -> 0.19%    |   603882   0.72% -> 0.55%
  600811   0.40% -> 0.66%    |   603899   0.40% -> 0.69%    |   600316   0.82% -> 0.87%
  603903   0.40% -> 0.38%    |   600323   0.35% -> 0.67%    |   600325   0.58% -> 0.57%
  300294   0.40% -> 0.18%    |   300298   0.59% -> 0.51%    |   600845   1.02% -> 0.81%
  002320   0.43% -> 0.31%    |   600340   0.43% -> 0.22%    |   601878   0.81% -> 0.49%
  002332   0.69% -> 0.66%    |   600862   0.68% -> 0.57%    |   300324   0.40% -> 0.47%
  300327   0.70% -> 0.61%    |   600875   0.49% -> 0.43%    |   000301   0.23% -> 0.19%
  002352   0.40% -> 0.36%    |   002867   0.40% -> 0.48%    |   600884   0.53% -> 0.52%
  600888   0.40% -> 0.39%    |   600377   0.24% -> 0.21%    |   300347   1.01% -> 0.41%
  600900   0.30% -> 0.65%    |   300357   0.99% -> 0.74%    |   002375   0.70% -> 0.22%
  601933   0.40% -> 0.11%    |   002901   0.39% -> 1.05%    |   603989   0.30% -> 0.26%
  300376   0.28% -> 0.23%    |   002406   0.40% -> 0.38%    |   002920   0.40% -> 0.25%
  300396   0.38% -> 0.27%    |   002414   1.02% -> 0.26%    |   603002   0.32% -> 0.29%
  300413   0.99% -> 0.55%    |   603016   0.18% -> 0.14%    |   002443   0.21% -> 0.29%
  603019   0.98% -> 0.48%    |   603533   0.42% -> 0.88%    |   000908   0.38% -> 0.48%
  300433   0.50% -> 0.11%    |   603026   0.37% -> 0.40%    |   000915   0.40% -> 0.78%
  002465   1.13% -> 0.47%    |   000932   0.39% -> 0.65%    |   600486   1.02% -> 0.24%
  603559   0.40% -> 0.84%    |   603566   0.69% -> 0.57%    |   300464   0.17% -> 0.17%
  601009   0.41% -> 0.53%    |   603568   0.30% -> 0.37%    |   002484   0.38% -> 0.11%
  601012   1.12% -> 0.57%    |   603577   0.39% -> 0.40%    |   601021   0.44% -> 0.42%
  603583   0.39% -> 0.53%    |   300481   0.35% -> 0.28%    |   002498   0.70% -> 0.51%
  002500   0.40% -> 0.17%    |   600009   0.30% -> 0.59%    |   600522   0.68% -> 0.53%
  002510   0.39% -> 0.40%    |   002511   0.40% -> 0.16%    |   600529   1.06% -> 0.16%
  600019   0.40% -> 0.52%    |   603096   0.27% -> 0.17%    |   603611   0.40% -> 0.35%
  000987   0.98% -> 1.00%    |   002530   0.44% -> 0.35%    |   300002   0.72% -> 0.32%
  600036   0.30% -> 0.70%    |   600549   0.72% -> 0.50%    |   002539   0.39% -> 0.37%
  300012   0.40% -> 0.62%    |   600048   0.40% -> 0.34%    |   002034   0.32% -> 0.25%
  002036   0.72% -> 0.36%    |   002549   0.39% -> 0.53%    |   300020   0.39% -> 0.16%
  600057   0.40% -> 0.50%    |   300031   0.39% -> 0.58%    | 

```